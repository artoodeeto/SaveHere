<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Save Here</title>
</head>

<body>
  <div>
    <label for="urlInput">URL:</label>
    <input type="text" id="urlInput">
    <button onclick="sendRequest()">Send Request</button>
    <div id="responseText"></div>
  </div>

  <div>
    <a href="/filemanager" target="_blank">File Manager</a>
  </div>

  <div>
    <ul id="files-list">

    </ul>
    <button onclick="getListOfFiles()">Refresh</button>
  </div>

  <script type="text/javascript">
    window.onload = () => getListOfFiles()

    function sendRequest() {
      const xhr = new XMLHttpRequest()
      const url = document.getElementById("urlInput").value
      xhr.open('POST', 'api/File/download')
      xhr.setRequestHeader('Content-Type', 'application/json')
      xhr.onreadystatechange = function () {
        if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
          document.getElementById("responseText").innerHTML = `<a href="${this.responseText}">Direct Link</a>`
          getListOfFiles()
        }
      };
      xhr.send(`"${url}"`)
    }

    function getListOfFiles() {
      var filesList = document.getElementById("files-list")
      filesList.innerHTML = ""

      const xhr = new XMLHttpRequest()
      xhr.open('GET', 'api/File/list')
      xhr.setRequestHeader('Content-Type', 'application/json')
      xhr.onreadystatechange = function () {
        if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
          var fileData = JSON.parse(this.responseText)
          fileData.forEach(fd => {
            filesList.innerHTML += `<li>
              <a href="files/${fd.Name}">${fd.Name}</a>- 
              ${fd.FullName} - 
              ${fd.Type} - 
              ${fd.Length} - 
              ${fd.Extension}
              <button onclick="deleteSelectedFile('${fd.FullName}')">Delete</button>
              </li>`
          })
        }
      };
      xhr.send()
    }

    function deleteSelectedFile(fullPath) {

      const xhr = new XMLHttpRequest()
      xhr.open('POST', 'api/File/delete')
      xhr.setRequestHeader('Content-Type', 'application/json')
      xhr.onreadystatechange = function () {
        if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
          getListOfFiles()
        }
      };
      xhr.send(`"${fullPath}"`)
    }
  </script>
</body>

</html>